---
title: "p8105_hw2_ars2376"
output: github_document
date: "2025-09-26"
---

```{r setup}
library(tidyverse)
library(readxl)
library(dplyr)
```

# Problem 1

Cleaning data from pols-month.csv

```{r}
pols_df =
  read_csv("fivethirtyeight_datasets/pols-month.csv", na = c("NA", ".", "")) |> 
  separate(
    mon, into = c("year", "month", "day"), sep = "-") |> 
 mutate(
      month = case_match(
        month, 
        "01" ~ "Jan",
        "02" ~ "Feb",
        "03" ~ "Mar",
        "04" ~ "Apr",
        "05" ~ "May",
        "06" ~ "Jun",
        "07" ~ "Jul",
        "08" ~ "Aug",
        "09" ~ "Sep",
        "10" ~ "Oct",
        "11" ~ "Nov",
        "12" ~"Dec")) |> 
  
  mutate(prez = case_when(
    prez_gop == 1 ~ "gop",
    prez_dem == 1 ~ "dem") 
) |> 
   select(-prez_dem, -prez_gop, -day) 
```

```{r}
pols_df <- pols_df |> 
  mutate(year = as.numeric(year))
pols_df
```

Clean data from snp.csv

```{r}
snp_df =
  read.csv("fivethirtyeight_datasets/snp.csv", na = c("NA", ".", "")) |>
  separate(
    date, into = c("month", "day", "year"), sep = "/") |> 
 mutate(
      month = case_match(
        month, 
        "1" ~ "Jan",
        "2" ~ "Feb",
        "3" ~ "Mar",
        "4" ~ "Apr",
        "5" ~ "May",
        "6" ~ "Jun",
        "7" ~ "Jul",
        "8" ~ "Aug",
        "9" ~ "Sep",
        "10" ~ "Oct",
        "11" ~ "Nov",
        "12" ~"Dec")) |> 
  relocate(year,month) |> 
  select(-day)
```

Change year variable to include 19 or 20

```{r}
snp_df <- mutate(snp_df, year = case_when(
  nchar(year) == 2 & as.numeric(year) > 0 & as.numeric(year) <= 15 ~ paste0("20", year),
  nchar(year) == 1 & as.numeric(year) >= 0 & as.numeric(year) <= 15 ~ paste0("200", year),
  nchar(year) == 2 & as.numeric(year) > 49 ~ paste0("19", year),
  TRUE ~ as.character(year)
))
```

```{r}
snp_df
```

Tidy unemployment.csv for merging

```{r}
unemp_df =
  read.csv("fivethirtyeight_datasets/unemployment.csv", na = c("NA", ".", "")) |> 
  pivot_longer(
    cols = Jan:Dec,
    names_to = "month",
    values_to = "unemp_pct"
  ) |> 
  janitor::clean_names() ## Changed Year to year
```

```{r}
unemp_df <- unemp_df |> 
  mutate(year = as.numeric(year))

unemp_df
```

Merge snp into pols

```{r}
pols_df <- pols_df |> 
  mutate(year = as.numeric(year))

snp_df <- snp_df |> 
  mutate(year = as.numeric(year))

pols_snp_df = 
  left_join(pols_df, snp_df, by = c("year","month"))
```

```{r}
pols_snp_df
```

Merge unemp into pols_snp

```{r}
final_df =
  left_join(pols_snp_df, unemp_df, by = c("year", "month"))
```

```{r}
final_df
```

### Write-up

One of the datasets used is the `pols-month` dataset, which describes the number of national politicians who are Democratic or Republican at any given time. Some key variables include date of the count, whether the president was Democratic or Republic on the associated date, number of Republican governors, number of Republican senators, number of Republican representatives, number of Democratic governors, number of Democratic senators, and number of Democratic representatives. The `snp` dataset describes the closing values of the Standard & Poor stock market index for a set of dates. The `unemployment` dataset measures the percentage of unemployment. The merged dataset of all 3 `final_df` contains 822 observations of 12 variables and the date ranges from 1947 to 2015.

## Problem 2

Clean data for Mr. Trash Wheel

```{r}
trashwh_df =
  read_excel("202509 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", na = c("NA", ".", ""), skip = 1, col_names = TRUE) |>
  janitor::clean_names() |> 
  head(707) |>  ## Omits last row
  mutate(sports_balls = as.integer(round(sports_balls))) |> 
  mutate(year = as.numeric(year)) |> 
  mutate(name = "Mr. Trash Wheel") |> 
  relocate(name)
```

```{r}
trashwh_df
```

Clean data for Professor Trash Wheel

```{r}
proftrashwh_df =
  read_excel("202509 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", na = c("NA", ".", ""), skip = 1, col_names = TRUE) |>
  janitor::clean_names() |> 
  head(132) |> ## Omits last row
  mutate(name = "Professor Trash Wheel") |> 
  relocate(name)
```

```{r}
proftrashwh_df
```

Clean data for Gwynnda

```{r}
gwynnda_df =
  read_excel("202509 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Falls Trash Wheel", na = c("NA", ".", ""), skip = 1, col_names = TRUE) |>
  janitor::clean_names() |> 
  head(349) |>  ## Omits last row
  mutate(name = "Gwynnda Trash Wheel") |> 
  relocate(name)
```

```{r}
gwynnda_df
```

Merge datasets

```{r}
alltrash_df = 
  bind_rows(trashwh_df, proftrashwh_df, gwynnda_df)
```


```{r}
alltrash_df
```

### Write-up

These data represents three water-wheel vessels that removes trash in harbors around Baltimore, Maryland. The three vessels are Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda. In total, there are `1,118` observations, and some key variables include `name` of the vessel, `date` of collection, `weight_tons`, `volume_cubic_yards`, litter type such as `plastic_bottles`, `cigarette_butts`, and `plastic_bags`, and `homes_powered`. The total weight collected by Professor Trash Wheel is `r alltrash_df |> filter(name == "Mr. Trash Wheel") |> summarize(total = sum(weight_tons, na.rm = TRUE)) |> pull(total)` tons. The total number of cigarette butts collected by Gwynnda in June of 2022 was `r alltrash_df |> filter(name == "Gwynnda Trash Wheel" & month == "June" & year == "2022") |> summarize(total=sum(cigarette_butts, na.rm = TRUE)) |> pull(total) |> format(scientific = FALSE)`.

## Problem 3

Clean Zillow datasets

```{r}
zipcode_df = 
  read_csv("zillow_data/Zip Codes.csv", na = c("NA", ".", ""), col_names = TRUE) |> 
  janitor::clean_names() |> 
  distinct() ## Gets unique rows
```

```{r}
zori_df =
  read_csv("zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv", na = c("NA", ".", ""), col_names = TRUE) |> 
  janitor::clean_names() |> 
  rename(zip_code = region_name) |> 
  pivot_longer(
    cols = x2015_01_31:x2024_08_31,
    names_to = "date_recorded",
    values_to = "zori",
    names_prefix = "x" 
  ) |> 
  mutate(date_recorded = str_replace_all(date_recorded, "_", "-")) |> 
  separate(
    date_recorded, into = c("year", "month", "day"), sep = "-") |> 
  distinct() ## Gets unique rows
```

Merge datasets

```{r}
zorimerged_df =
  left_join(zori_df, zipcode_df, by = c("zip_code"), relationship = "many-to-many") |> 
  select(-size_rank, -region_type, -county_name, -state_name, -metro, -state_fips, -file_date) |> 
  relocate(neighborhood, .after = city) |> 
  relocate(zip_code, .after = neighborhood)
```

Unique zip codes and neighborhoods

```{r}
length(unique(zorimerged_df$zip_code[!is.na(zorimerged_df$zip_code)]))
length(unique(zorimerged_df$neighborhood[!is.na(zorimerged_df$neighborhood)]))
```

### Write up

The resulting dataset has `17,516` observations. It describes the Zillow Observed Rent Index (ZORI) for `r length(unique(zorimerged_df$zip_code[!is.na(zorimerged_df$zip_code)]))` unique zip codes and `r length(unique(zorimerged_df$neighborhood[!is.na(zorimerged_df$neighborhood)]))` unique neighborhoods. The dataset also includes the `year`, `month`, and `day` of when the ZORI for each observation was recorded. Other notable variables are `county` and `county_code`.

Rental prices in January 2020 vs January 2021

```{r}
drop_df =
  zorimerged_df |> 
  select(state, city, neighborhood, zip_code, year, month, zori, county) |> 
  filter(month == "01", year == "2020" | year == "2021") |> 
  pivot_wider(
    names_from = "year",
    values_from = "zori"
    ) |> 
  rename(before_covid = "2020",
         after_covid = "2021") |> 
  mutate(drop_price = before_covid - after_covid)
```

10 zip codes with largest drop in rental price from January 2020 to January 2021

```{r}
top_10 = drop_df |> 
  filter(!is.na(drop_price)) |> ## excludes na values in drop_price
  filter(!is.na(neighborhood)) |> ## excludes na values in neighborhood
  arrange(desc(drop_price)) |> 
  slice(1:10) |> 
  select(-state,-city)
```

```{r}
top_10
```

### Write up

In January 2020, the average rental price is `r mean(drop_df$before_covid[!is.na(drop_df$before_covid)])` while the average price in January 2021 is `r mean(drop_df$after_covid[!is.na(drop_df$after_covid)])`. This shows a drop from January 2020 to January 2021. The table above further displays the 10 zip codes with the largest drop in rental price from January 2020 to January 2021 along with their respective neighborhoods. The largest drop in rental price is `r max(top_10$drop_price)` in the zip code 10007 which is associated with Lower Manhattan while the smallest drop within this list is `r min(top_10$drop_price)` in the zip code 10003 which is associated with the Lower East side. Most of largest rental price drops from January 2020 to 2021 occured in Lower Manhattan and Lower East Side.